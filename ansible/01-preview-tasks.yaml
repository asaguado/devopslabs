# Tareas previas de configuración, estas tareas se han de realizar en todos los nodos.
# > Configuración de la sincronización horaria:
# timedatectl set-timezone Europe/Madrid
# dnf install chrony -y
# systemctl enable chronyd
# systemctl start chronyd
# timedatectl set-ntp true
# > Desativamos SELinux ya que no lo vamos a utilizar con kubernetes
# sed -i s/=enforcing/=disabled/g /etc/selinux/config
# > reboot?
# > Instalamos los siguientes paquetes:
# dnf install nfs-utils nfs4-acl-tools wget -y

- name: Preview task in all nodes (master and workers)
  gather_facts: false
  hosts: all
  tasks:

    - name: Set timezone to Europe/Madrid
      timezone:
        name: Europe/Madrid

    - name: Install the latest version of Chrony
      dnf:
        name: chrony
        state: latest
      become: yes

    - name: Make sure a chrony service unit is enabled and running
      ansible.builtin.systemd:
        name: chronyd
        state: started        
        enabled: yes
      become: yes
    
    - name: Enable ntp
      command: /usr/bin/timedatectl set-ntp true
      become: yes

    - name: Deactivate SELinux
      command: /usr/bin/sed -i s/=enforcing/=disabled/g /etc/selinux/config
      become: yes

    - name: Install NFS packages and wget package
      dnf:
        name: 
          - nfs-utils
          - nfs4-acl-tools
          - wget
        state: present
      become: yes    

