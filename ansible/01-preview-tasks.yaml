# Tareas previas de configuración, estas tareas se han de realizar en todos los nodos.
# > Configuración de la sincronización horaria:
# timedatectl set-timezone Europe/Madrid
# dnf install chrony -y
# systemctl enable chronyd
# systemctl start chronyd
# timedatectl set-ntp true
# > Desativamos SELinux ya que no lo vamos a utilizar con kubernetes
# sed -i s/=enforcing/=disabled/g /etc/selinux/config
# > reboot?
# > Instalamos los siguientes paquetes:
# dnf install nfs-utils nfs4-acl-tools wget -y

- name: Preview task in all nodes (master and workers)
  gather_facts: false
  hosts: all
  tasks:
    - name: Display the config
      debug:
        msg: "Hello world!"

    - name: Set timezone to Europe/Madrid
      timezone:
        name: Europe/Madrid

    - name: Install the latest version of Chrony
      dnf:
        name: chrony
        state: latest
      become: yes

    - name: Make sure a chrony service unit is enabled and running
      ansible.builtin.systemd:
        name: chrony
        enabled: yes          
        state: started
      become: yes
    
    - name: Enable ntp
      command: /usr/bin/timedatectl set-ntp true
      when: "'Network time on: no' in timedatectl_result.stdout"
      become: yes

