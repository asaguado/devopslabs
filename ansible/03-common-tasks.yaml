# Tareas comunes a realizar en el nodo master y los workers, que
# se realizar√°n en los nodos master.local y worker.local

# Common task in all nodes
- name: Common task in all nodes
  gather_facts: false
  hosts: all
  tasks:

    # Make sure a 'firewalld' service unit is enabled and running
    - name: Make sure a 'firewalld' service unit is enabled and running
      ansible.builtin.systemd:
        name: firewalld
        state: started        
        enabled: yes
      become: yes

    # Activate transparent masquerading
    - name: Activate transparent masquerading
      command: /usr/sbin/modprobe br_netfilter
      become: yes

  # Add permanent masquerade
  #  - name: Add permanent masquerade
  #    firewalld:
  #      masquerade: yes
  #      state: enabled        
  #      permanent: true
  #    become: yes  

   # Open firewall ports to the service: mountd
    - name: Open firewall ports to mountd service
      command: /usr/bin/firewall-cmd --add-masquerade --permanent
      become: yes  

   # Reload 'firewalld' service
    - name: Reload 'firewalld' service
      systemd:
        name: firewalld
        state: reloaded
      become: yes