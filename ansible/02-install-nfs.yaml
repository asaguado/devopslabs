# En la instalación del servidor NFS en local no será necesario añadir un disco
# dnf install nfs-utils net-tools -y
# systemctl  enable nfs-server
# systemctl start nfs-server
# Config the share access to the NFS
# cat /etc/exports 
# Read '/etc/exports' and apply the new configuration
# exportfs -r
# exportfs -s
# Open firewall ports to the services: nfs, rpc-bind, mountd
# firewall-cmd --permanent --add-service=nfs
# firewall-cmd --permanent --add-service=rpc-bind
# firewall-cmd --permanent --add-service=mountd
# firewall-cmd --reload


# NFS Server installation (only in master)
- name: Server NFS installation (only in master)
  gather_facts: false
  hosts: all
  tasks:

    # Install the latest version of 'nfs-utils' and 'net-tools' package
    # Instalamos los paquetes de NFS y arrancamos el servicio:
    - name: Install the latest version of 'nfs-utils' and 'net-tools'
      dnf:
        name: 
          - nfs-utils
          - net-tools
        state: latest
      become: yes

    # Make sure a nfs-server service unit is enabled and running
    - name: Make sure a nfs-server service unit is enabled and running
      ansible.builtin.systemd:
        name: nfs-server
        state: started        
        enabled: yes
      become: yes

    # Read '/etc/exports' and apply the new configuration
    - name: Read '/etc/exports' and apply the new configuration
      command: /usr/bin/exportfs -r
      become: yes

    # Read '/etc/exports' and apply the new configuration
    - name: Read '/etc/exports' and apply the new configuration
      command: /usr/bin/exportfs -s
      become: yes      